<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTubeå‹•ç”»ã‚°ãƒªãƒ¼ãƒ³ã‚¦ã‚©ãƒƒã‚·ãƒ¥è¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;700;900&family=Noto+Sans+JP:wght@300;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5e3f;
            --secondary: #f4a259;
            --accent: #e63946;
            --bg: #fafafa;
            --card: #ffffff;
            --text: #1a1a1a;
            --text-muted: #666;
            --border: #e0e0e0;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.6s ease;
        }

        h1 {
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-weight: 900;
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            font-weight: 300;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            animation: fadeInUp 0.6s ease;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 94, 63, 0.1);
        }

        .button {
            background: linear-gradient(135deg, var(--primary) 0%, #2d7a54 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Zen Kaku Gothic New', sans-serif;
            box-shadow: 0 4px 12px rgba(26, 94, 63, 0.3);
            width: 100%;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(26, 94, 63, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            display: none;
        }

        .loading.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        .frames-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .frame-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .frame-item:hover {
            transform: scale(1.05);
        }

        .frame-item img {
            width: 100%;
            height: auto;
            display: block;
        }

        .frame-label {
            background: var(--primary);
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .analysis-section {
            margin-top: 2rem;
        }

        .analysis-section h3 {
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
            border-left: 4px solid var(--secondary);
            padding-left: 1rem;
        }

        .risk-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .risk-high {
            background: #ffe5e5;
            color: #c92a2a;
        }

        .risk-medium {
            background: #fff3bf;
            color: #d68200;
        }

        .risk-low {
            background: #d3f9d8;
            color: #2f9e44;
        }

        .analysis-content {
            line-height: 1.8;
            color: var(--text);
        }

        .analysis-content p {
            margin-bottom: 1rem;
        }

        .analysis-content ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .analysis-content li {
            margin-bottom: 0.5rem;
        }

        .error {
            background: #ffe5e5;
            border-left: 4px solid var(--accent);
            padding: 1rem;
            border-radius: 8px;
            color: #c92a2a;
            display: none;
            margin-top: 1rem;
        }

        .error.active {
            display: block;
            animation: shake 0.5s ease;
        }

        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #1976d2;
        }

        .info-box h4 {
            color: #0d47a1;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .info-box p {
            color: #1565c0;
            line-height: 1.6;
            margin: 0;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            .card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ¿ YouTubeå‹•ç”»ã‚°ãƒªãƒ¼ãƒ³ã‚¦ã‚©ãƒƒã‚·ãƒ¥è¨ºæ–­</h1>
            <p class="subtitle">ç’°å¢ƒè¨´æ±‚ã®é©åˆ‡æ€§ã‚’å¤šè§’çš„ã«åˆ†æã—ã¾ã™</p>
        </header>

        <div class="card">
            <div class="info-box">
                <h4>ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦</h4>
                <p>YouTubeå‹•ç”»ã®URLã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€ç’°å¢ƒè¨´æ±‚è¡¨ç¾ã®ã‚°ãƒªãƒ¼ãƒ³ã‚¦ã‚©ãƒƒã‚·ãƒ¥è©²å½“æ€§ã‚’è‡ªå‹•è¨ºæ–­ã—ã¾ã™ã€‚è¦–è¦šè¦ç´ ã€æ–‡è¨€ã€å…¨ä½“çš„ãªå°è±¡ã‚’ç·åˆçš„ã«ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>
            </div>

            <div class="input-group">
                <label for="videoUrl">YouTubeå‹•ç”»URL</label>
                <input type="text" id="videoUrl" placeholder="https://www.youtube.com/watch?v=..." />
            </div>

            <div class="input-group">
                <label for="subtitles">å­—å¹•ãƒ»ã‚»ãƒªãƒ•ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                <textarea id="subtitles" rows="4" placeholder="å‹•ç”»å†…ã®æ–‡è¨€ã‚„ã‚»ãƒªãƒ•ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"></textarea>
            </div>

            <button class="button" onclick="analyzeVideo()">è¨ºæ–­ã‚’é–‹å§‹</button>

            <div class="error" id="error"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>å‹•ç”»ã‚’åˆ†æä¸­ã§ã™...</p>
                <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 0.5rem;">YouTubeå‹•ç”»ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨AIåˆ†æã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ï¼ˆ30ã€œ90ç§’ç¨‹åº¦ã‹ã‹ã‚Šã¾ã™ï¼‰</p>
            </div>
        </div>

        <div class="card results" id="results">
            <div class="analysis-section">
                <h3>è¨ºæ–­çµæœ</h3>
                <div id="riskLevel"></div>
                <div id="analysisContent" class="analysis-content"></div>
            </div>

            <div class="analysis-section">
                <h3>æŠ½å‡ºã•ã‚ŒãŸã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ </h3>
                <div class="frames-grid" id="framesGrid"></div>
            </div>
        </div>
    </div>

    <script>
        let extractedFrames = [];
        
        async function analyzeVideo() {
            const videoUrl = document.getElementById('videoUrl').value.trim();
            const subtitles = document.getElementById('subtitles').value.trim();
            
            const errorDiv = document.getElementById('error');
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            
            errorDiv.classList.remove('active');
            resultsDiv.classList.remove('active');
            
            if (!videoUrl) {
                showError('YouTube URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            loadingDiv.classList.add('active');
            
            try {
                // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã§YouTubeå‹•ç”»ã‹ã‚‰ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º
                const response = await fetch('/api/extract-youtube-frames', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        videoUrl: videoUrl,
                        maxDuration: 60
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'YouTubeå‹•ç”»ã®å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                extractedFrames = data.frames;
                
                // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
                displayFrames();
                
                // Claude APIã§åˆ†æ
                await analyzeWithClaude(subtitles);
                
            } catch (error) {
                showError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                loadingDiv.classList.remove('active');
            }
        }
        
        function displayFrames() {
            const framesGrid = document.getElementById('framesGrid');
            framesGrid.innerHTML = '';
            
            extractedFrames.forEach((frame, index) => {
                const frameDiv = document.createElement('div');
                frameDiv.className = 'frame-item';
                frameDiv.innerHTML = `
                    <img src="${frame.dataUrl}" alt="Frame ${index + 1}" />
                    <div class="frame-label">${frame.time}ç§’</div>
                `;
                framesGrid.appendChild(frameDiv);
            });
        }
        
        async function analyzeWithClaude(subtitles) {
            const content = [
                {
                    type: "text",
                    text: `ã‚ãªãŸã¯ç’°å¢ƒæ³•ã®å°‚é–€å®¶ã¨ã—ã¦ã€ä»¥ä¸‹ã®å‹•ç”»ã®ã‚°ãƒªãƒ¼ãƒ³ã‚¦ã‚©ãƒƒã‚·ãƒ¥è©²å½“æ€§ã‚’è¨ºæ–­ã—ã¦ãã ã•ã„ã€‚

ã€åˆ†æã™ã‚‹è¦ç´ ã€‘
1. è¦–è¦šçš„è¦ç´ ï¼š${extractedFrames.length}æšã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã€è‡ªç„¶ã‚¤ãƒ¡ãƒ¼ã‚¸ã®éå‰°ä½¿ç”¨ã€èª¤è§£ã‚’æ‹›ãè¦–è¦šè¡¨ç¾
2. æ–‡è¨€ãƒ»ã‚»ãƒªãƒ•ï¼š${subtitles ? 'æä¾›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ' : 'å­—å¹•æƒ…å ±ãªã—'}
3. å…¨ä½“çš„å°è±¡ï¼šç’°å¢ƒä¸»å¼µã®å…·ä½“æ€§ã€æ ¹æ‹ ã®æœ‰ç„¡ã€æ³•è¦åˆ¶ã¨ã®æ•´åˆæ€§

ã€è¨ºæ–­åŸºæº–ã€‘
- EU Green Claims Directive
- æ—¥æœ¬ã®æ™¯å“è¡¨ç¤ºæ³•ï¼ˆå„ªè‰¯èª¤èªï¼‰
- æ¶ˆè²»è€…åºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- ã‚«ãƒ¼ãƒœãƒ³ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«è¡¨ç¤ºã®é©åˆ‡æ€§

${subtitles ? `ã€å‹•ç”»å†…ãƒ†ã‚­ã‚¹ãƒˆã€‘\n${subtitles}\n` : ''}

ã€å‡ºåŠ›å½¢å¼ã€‘
1. ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ï¼ˆé«˜ãƒ»ä¸­ãƒ»ä½ï¼‰
2. å…·ä½“çš„ãªå•é¡Œç‚¹
3. æ”¹å–„ææ¡ˆ
4. æ³•çš„ãƒªã‚¹ã‚¯ã®è©•ä¾¡

ç”»åƒã‚’ç¢ºèªã—ã¦ã€è©³ç´°ãªè¨ºæ–­ã‚’æ—¥æœ¬èªã§æä¾›ã—ã¦ãã ã•ã„ã€‚`
                }
            ];
            
            // ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒã‚’è¿½åŠ 
            for (const frame of extractedFrames) {
                content.push({
                    type: "image",
                    source: {
                        type: "base64",
                        media_type: "image/jpeg",
                        data: frame.dataUrl.split(',')[1]
                    }
                });
            }
            
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 4000,
                        messages: [
                            { role: "user", content: content }
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error('AIåˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                const analysis = data.content[0].text;
                
                displayResults(analysis);
                
            } catch (error) {
                showError('AIåˆ†æã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }
        
        function displayResults(analysis) {
            // ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤å®š
            let riskLevel = 'low';
            let riskText = 'ä½ãƒªã‚¹ã‚¯';
            let riskClass = 'risk-low';
            
            if (analysis.includes('é«˜ãƒªã‚¹ã‚¯') || analysis.includes('é‡å¤§ãª')) {
                riskLevel = 'high';
                riskText = 'é«˜ãƒªã‚¹ã‚¯';
                riskClass = 'risk-high';
            } else if (analysis.includes('ä¸­ãƒªã‚¹ã‚¯') || analysis.includes('æ³¨æ„')) {
                riskLevel = 'medium';
                riskText = 'ä¸­ãƒªã‚¹ã‚¯';
                riskClass = 'risk-medium';
            }
            
            document.getElementById('riskLevel').innerHTML = 
                `<span class="risk-badge ${riskClass}">ã‚°ãƒªãƒ¼ãƒ³ã‚¦ã‚©ãƒƒã‚·ãƒ¥ãƒªã‚¹ã‚¯: ${riskText}</span>`;
            
            // åˆ†æå†…å®¹ã‚’æ•´å½¢ã—ã¦è¡¨ç¤º
            const formattedAnalysis = analysis
                .replace(/ã€(.*?)ã€‘/g, '<h4 style="color: var(--primary); margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: 700;">$1</h4>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^/, '<p>')
                .replace(/$/, '</p>');
            
            document.getElementById('analysisContent').innerHTML = formattedAnalysis;
            document.getElementById('results').classList.add('active');
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
        }
    </script>
</body>
</html>
